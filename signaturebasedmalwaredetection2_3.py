#!/usr/bin/env python3
# Script: Ops 401 Class 31 Signature-based Malware Detection Part 1 of 3
# Author: Zachary Derrick                    
# Date of latest revision:  11/14/22    
# Purpose: Begin development of our own basic antivirus tool in Python.

import hashlib, subprocess
from sys import platform

line = "\n-------------------------------------------------------------( ◣∀◢)ψ------------------\n"

def looper():
    print(line)

def hash_file(filename):
   """"This function returns the SHA-1 hash
   of the file passed into it"""

   # make a hash object
   h = hashlib.sha1()

   # open file for reading in binary mode
   with open(filename,'rb') as file:

       # loop till the end of the file
       chunk = 0
       while chunk != b'':
           # read only 1024 bytes at a time
           chunk = file.read(1024)
           h.update(chunk)

   # return the hex representation of digest
   return h.hexdigest()

# message = hash_file("track1.mp3")
# print(message)

def linuxmenu():
    print(line,"\nWelcome to Malware Detection Tool For Linux")
    print("[1] Check for File")
    print("[2] Get a Hash Value")
    # print("[3] Option 3")
    print("[0] Exit the Program")
    # linux_main()

def windowsmenu():
    print(line,"\nWelcome to Malware Detection Tool For Windows")
    print("[1] Check for File")
    print("[2] Get a Hash Value")
    # print("[3] Option 3")
    print("[0] Exit the Program")
    windows_main()

def linux_main():
    option = int(input("Enter your choice: "))
    return option

def windows_main():
    option = int(input("Enter your choice: "))
    return option

def linuxfilesearch():
    file_name = get_filename()
    linux_path =  get_pathL()
    cmd = ["find", linux_path,"-name", file_name] 
    count = subprocess.Popen("ls " + str(linux_path) + " | echo \" $(wc -l) files were searched in this process.\"", shell=True)
    subprocess.run(cmd)

def windowsfilesearch():
    file_name = get_filename()
    win_path =  get_pathW()
    cmd = [f"dir /S /P {win_path}\{file_name}"] 
    count = subprocess.Popen("dir " + str(win_path) + " | echo \" $(wc -l) files were searched in this process.\"", shell=True)
    subprocess.run(cmd) 

def get_filename():
    file_name = input("Enter a file name: ") or "welcome.txt"
    return file_name
def get_pathW():
    windows_path = input("Enter path to file: ")
    return windows_path
def get_pathL():
    linux_path =  input("Enter path to file: ") or "/home/zaxxon/"
    return linux_path

if __name__ == '__main__':
    looper()
    if platform == "linux" or platform == "linux2":
        linuxmenu()
        option = int(input("Enter your choice: "))
        while option != 0:
            if option == 1:
                print("Option 1")
                break
            elif option == 2:
                    print("Option 2")
                    linuxmenu()
            else:
                print("Invalid Option")
    elif platform == "darwin":
        print("This script is not written for MacOS")
    elif platform == "win32":
        windowsmenu()
        while option != 0:
            if option == 1:
                print("Option 1")
            elif option == 2:
                print("Option 2")
            else:
                print("Invalid Option")
    looper()
   
# while option != 0:
#     if option == 1:
#         print("Option 1")
#     elif option == 2:
#          print("Option 2")
#     else:
#         print("Invalid Option")

#     print()
    
#     option = int(input("Option?"))          